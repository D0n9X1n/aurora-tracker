<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#00d4ff">
  <meta name="description" content="Nocturne - Your 24x7 Personal Assistant for Northern Lights, Weather, Crypto, Stocks, and News">
  
  <title>Nocturne - 24x7 Personal Assistant</title>
  
  <!-- PWA -->
  <link rel="manifest" href="/public/manifest.json">
  <link rel="icon" type="image/svg+xml" href="/public/favicon.svg">
  <link rel="apple-touch-icon" href="/public/icons/icon-192.png">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/src/css/styles.css">
  <link rel="stylesheet" href="/src/css/nocturne.css">
  <link rel="stylesheet" href="/src/css/charts.css">
  
  <!-- Preconnect to APIs -->
  <link rel="preconnect" href="https://api.open-meteo.com">
  <link rel="preconnect" href="https://api.coingecko.com">
  <link rel="preconnect" href="https://query1.finance.yahoo.com">
</head>
<body>
  <div class="nocturne-app">
    
    <!-- Global Header -->
    <header class="nocturne-header">
      <div class="header-brand">
        <h1>üåô Nocturne</h1>
        <span class="header-tagline">Your 24x7 Personal Assistant</span>
      </div>
      <div class="header-status">
        <div class="global-status" id="global-status">
          <span class="status-dot normal"></span>
          <span class="status-text">All Systems Normal</span>
        </div>
        <div class="header-time" id="header-time">--:--</div>
      </div>
    </header>

    <!-- Module Tabs -->
    <nav class="module-tabs" id="module-tabs">
      <button class="tab-btn active" data-module="dashboard">
        <span class="tab-icon">üìä</span>
        <span class="tab-name">Dashboard</span>
        <span class="tab-status" id="dashboard-tab-status"></span>
      </button>
      <button class="tab-btn" data-module="aurora">
        <span class="tab-icon">üåå</span>
        <span class="tab-name">Aurora</span>
        <span class="tab-status" id="aurora-tab-status"></span>
      </button>
      <button class="tab-btn" data-module="crypto">
        <span class="tab-icon">üí∞</span>
        <span class="tab-name">Crypto</span>
        <span class="tab-status" id="crypto-tab-status"></span>
      </button>
      <button class="tab-btn" data-module="stocks">
        <span class="tab-icon">üìà</span>
        <span class="tab-name">Stocks</span>
        <span class="tab-status" id="stocks-tab-status"></span>
      </button>
      <button class="tab-btn" data-module="news">
        <span class="tab-icon">üì∞</span>
        <span class="tab-name">News</span>
        <span class="tab-status" id="news-tab-status"></span>
      </button>
      <button class="tab-btn" data-module="settings">
        <span class="tab-icon">‚öôÔ∏è</span>
        <span class="tab-name">Settings</span>
        <span class="tab-status" id="settings-tab-status"></span>
      </button>
    </nav>

    <!-- Module Content Area -->
    <main class="module-container" id="module-container">
      
      <!-- Dashboard Module (Default) -->
      <div class="module-panel active" id="panel-dashboard">
        <!-- Loaded dynamically -->
      </div>

      <!-- Aurora Module -->
      <div class="module-panel" id="panel-aurora">
        <!-- Aurora tracker content will be loaded here -->
        <div class="app">
          
          <!-- Loading State -->
          <div id="loading-state" class="state-container">
            <div class="spinner"></div>
            <p>Analyzing space weather...</p>
          </div>

          <!-- Error State = NO GO -->
          <div id="error-state" class="state-container" style="display:none">
            <div class="decision-card no-go">
              <div class="decision-icon">üö´</div>
              <div class="decision-text">NO GO</div>
              <div class="decision-reason">Unable to fetch data</div>
            </div>
            <p class="error-detail" id="error-message">Check your connection</p>
            <button class="retry-btn" id="retry-btn">Retry</button>
          </div>

          <!-- Main Content -->
          <main id="content-state" style="display:none">
            
            <!-- Header -->
            <header class="aurora-header">
              <div>
                <h2>üåå Aurora Tracker</h2>
                <p id="location-info">üìç Loading location...</p>
              </div>
              <div class="live-indicator">
                <span class="live-dot"></span>
                <span id="last-updated">--</span>
              </div>
            </header>

            <!-- Desktop Layout Container -->
            <div class="main-grid">
              
              <!-- LEFT COLUMN - Decision & Key Factors -->
              <div class="left-column">
                
                <!-- #1 THE DECISION - Big & Bold -->
                <section id="decision-card" class="decision-card">
                  <div class="decision-icon" id="decision-icon">‚è≥</div>
                  <div class="decision-text" id="decision-text">CHECKING</div>
                  <div class="decision-reason" id="decision-reason">Analyzing conditions...</div>
                </section>

                <!-- #2 G4 SIMILARITY -->
                <section class="similarity-section">
                  <div class="similarity-header">
                    <span>üåü G4 Storm Match</span>
                    <span class="similarity-badge" id="similarity-badge">--%</span>
                  </div>
                  <div class="similarity-bar">
                    <div class="similarity-fill" id="similarity-bar"></div>
                    <div class="similarity-markers">
                      <span class="marker" style="left:25%">25%</span>
                      <span class="marker" style="left:50%">50%</span>
                      <span class="marker" style="left:75%">75%</span>
                    </div>
                  </div>
                  <p class="similarity-desc">vs <strong>May 10-11, 2024</strong> G4 storm</p>
                </section>

                <!-- #3 TWO KEY FACTORS -->
                <section class="factors">
                  <div class="factor">
                    <div class="factor-header">
                      <span class="factor-label">üåå Aurora</span>
                      <span class="factor-value" id="aurora-value">--%</span>
                    </div>
                    <div class="factor-bar">
                      <div class="factor-fill" id="aurora-bar"></div>
                    </div>
                    <div class="factor-hint" id="aurora-hint">--</div>
                  </div>
                  
                  <div class="factor">
                    <div class="factor-header">
                      <span class="factor-label">‚òÅÔ∏è Sky</span>
                      <span class="factor-value" id="sky-value">--%</span>
                    </div>
                    <div class="factor-bar">
                      <div class="factor-fill" id="sky-bar"></div>
                    </div>
                    <div class="factor-hint" id="sky-hint">--</div>
                  </div>
                </section>

                <!-- #4 RECOMMENDATION -->
                <section class="action-box" id="action-box">
                  <div class="action-title">üí° Recommendation</div>
                  <p class="action-text" id="action-text">Waiting for data...</p>
                </section>

                <!-- Cloud Coverage (Compact) -->
                <section class="clouds-section">
                  <div class="clouds-header">
                    <h3>‚òÅÔ∏è Cloud Cover</h3>
                    <span class="cloud-total-inline" id="cloud-total">--%</span>
                    <span class="cloud-trend" id="cloud-trend">--</span>
                  </div>
                  <div class="cloud-layers-compact">
                    <div class="cloud-layer-compact">
                      <span class="cloud-label">Low</span>
                      <div class="cloud-bar"><div class="cloud-fill low" id="cloud-low-bar"></div></div>
                      <span class="cloud-val" id="cloud-low">--%</span>
                    </div>
                    <div class="cloud-layer-compact">
                      <span class="cloud-label">Mid</span>
                      <div class="cloud-bar"><div class="cloud-fill mid" id="cloud-mid-bar"></div></div>
                      <span class="cloud-val" id="cloud-mid">--%</span>
                    </div>
                    <div class="cloud-layer-compact">
                      <span class="cloud-label">High</span>
                      <div class="cloud-bar"><div class="cloud-fill high" id="cloud-high-bar"></div></div>
                      <span class="cloud-val" id="cloud-high">--%</span>
                    </div>
                  </div>
                </section>

                <!-- Today's Weather (Current Conditions) -->
                <section class="weather-today-section">
                  <div class="weather-today-header">
                    <h3>üå°Ô∏è Current Weather</h3>
                    <span class="weather-location" id="weather-location">--</span>
                  </div>
                  <div class="weather-today-content">
                    <div class="weather-today-main">
                      <span class="weather-icon-lg" id="weather-icon">--</span>
                      <div class="weather-temp-wrap">
                        <span class="weather-temp" id="weather-temp">--¬∞</span>
                        <span class="weather-desc" id="weather-desc">Loading...</span>
                      </div>
                    </div>
                    <div class="weather-today-details">
                      <div class="weather-detail">
                        <span class="detail-icon">üå°Ô∏è</span>
                        <span class="detail-label">Feels</span>
                        <span class="detail-val" id="weather-feels">--¬∞</span>
                      </div>
                      <div class="weather-detail">
                        <span class="detail-icon">üíß</span>
                        <span class="detail-label">Humidity</span>
                        <span class="detail-val" id="weather-humidity">--%</span>
                      </div>
                      <div class="weather-detail">
                        <span class="detail-icon">üí®</span>
                        <span class="detail-label">Wind</span>
                        <span class="detail-val" id="weather-wind">-- mph</span>
                      </div>
                      <div class="weather-detail">
                        <span class="detail-icon">üëÅÔ∏è</span>
                        <span class="detail-label">Visibility</span>
                        <span class="detail-val" id="weather-visibility">-- mi</span>
                      </div>
                    </div>
                  </div>
                  <div class="weather-viewing-tip" id="weather-viewing-tip">
                    <span class="tip-icon">üí°</span>
                    <span class="tip-text">Weather tip will appear here</span>
                  </div>
                </section>

              </div>

              <!-- RIGHT COLUMN - All the Data -->
              <div class="right-column">
                
                <!-- NOAA Storm Scale - Current Observed -->
                <section class="storm-section">
                  <div class="storm-section-header">
                    <span class="storm-label">‚ö° Current Observed</span>
                    <span class="storm-time" id="g-observed-time">--</span>
                  </div>
                  <div class="storm-scale">
                    <div class="storm-level" id="g0"><span>G0</span></div>
                    <div class="storm-level" id="g1"><span>G1</span></div>
                    <div class="storm-level" id="g2"><span>G2</span></div>
                    <div class="storm-level" id="g3"><span>G3</span></div>
                    <div class="storm-level" id="g4"><span>G4</span></div>
                    <div class="storm-level" id="g5"><span>G5</span></div>
                  </div>
                  <p class="storm-current" id="g-scale-text">G0 - No Storm</p>
                </section>

                <!-- NOAA Storm Scale - Predicted -->
                <section class="storm-section storm-predicted">
                  <div class="storm-section-header">
                    <span class="storm-label">üîÆ Predicted (24h)</span>
                    <span class="storm-time" id="g-predicted-time">--</span>
                  </div>
                  <div class="storm-scale">
                    <div class="storm-level" id="gp0"><span>G0</span></div>
                    <div class="storm-level" id="gp1"><span>G1</span></div>
                    <div class="storm-level" id="gp2"><span>G2</span></div>
                    <div class="storm-level" id="gp3"><span>G3</span></div>
                    <div class="storm-level" id="gp4"><span>G4</span></div>
                    <div class="storm-level" id="gp5"><span>G5</span></div>
                  </div>
                  <p class="storm-current" id="g-predicted-text">G0 - No Storm</p>
                </section>


                <!-- PRIMARY METRICS -->
                <section class="metrics-section">
                  <h2>üìä Space Weather Data</h2>
                  
                  <div class="metrics-grid">
                    
                    <!-- Bz Field - THE Key Metric -->
                    <div class="metric-card primary" data-tooltip="THE most important factor! Negative Bz (southward IMF) opens Earth's magnetosphere to solar wind.">
                      <div class="metric-header">
                        <span class="metric-icon">‚ö°</span>
                        <span class="metric-name">Bz Field</span>
                        <span class="metric-badge">KEY</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="bz-current">--</span>
                          <span class="unit">nT</span>
                        </div>
                        <div class="metric-vs">vs</div>
                        <div class="metric-baseline">
                          <span class="val" id="bz-baseline">-30</span>
                          <span class="unit">nT</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="bz-bar"></div></div>
                      <div class="metric-status" id="bz-status">--</div>
                    </div>

                    <!-- Solar Wind Speed -->
                    <div class="metric-card" data-tooltip="Speed of solar wind particles. Faster = more energy.">
                      <div class="metric-header">
                        <span class="metric-icon">üí®</span>
                        <span class="metric-name">Solar Wind</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="speed-current">--</span>
                          <span class="unit">km/s</span>
                        </div>
                        <div class="metric-vs">vs</div>
                        <div class="metric-baseline">
                          <span class="val" id="speed-baseline">750</span>
                          <span class="unit">km/s</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="speed-bar"></div></div>
                      <div class="metric-status" id="speed-status">--</div>
                    </div>

                    <!-- Dynamic Pressure -->
                    <div class="metric-card" data-tooltip="How hard solar wind pushes against Earth's magnetic field.">
                      <div class="metric-header">
                        <span class="metric-icon">üí•</span>
                        <span class="metric-name">Pressure</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="pressure-current">--</span>
                          <span class="unit">nPa</span>
                        </div>
                        <div class="metric-vs">vs</div>
                        <div class="metric-baseline">
                          <span class="val" id="pressure-baseline">15</span>
                          <span class="unit">nPa</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="pressure-bar"></div></div>
                      <div class="metric-status" id="pressure-status">--</div>
                    </div>

                    <!-- Particle Density -->
                    <div class="metric-card" data-tooltip="Particle count per cubic centimeter.">
                      <div class="metric-header">
                        <span class="metric-icon">üåä</span>
                        <span class="metric-name">Density</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="density-current">--</span>
                          <span class="unit">p/cm¬≥</span>
                        </div>
                        <div class="metric-vs">vs</div>
                        <div class="metric-baseline">
                          <span class="val" id="density-baseline">25</span>
                          <span class="unit">p/cm¬≥</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="density-bar"></div></div>
                      <div class="metric-status" id="density-status">--</div>
                    </div>

                    <!-- Bt Total Field -->
                    <div class="metric-card" data-tooltip="Total interplanetary magnetic field strength.">
                      <div class="metric-header">
                        <span class="metric-icon">üß≤</span>
                        <span class="metric-name">Bt Field</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="bt-current">--</span>
                          <span class="unit">nT</span>
                        </div>
                        <div class="metric-vs">vs</div>
                        <div class="metric-baseline">
                          <span class="val" id="bt-baseline">40</span>
                          <span class="unit">nT</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="bt-bar"></div></div>
                      <div class="metric-status" id="bt-status">--</div>
                    </div>

                    <!-- Clock Angle -->
                    <div class="metric-card clock-card" data-tooltip="IMF clock angle - 180¬∞ = pure southward (best).">
                      <div class="metric-header">
                        <span class="metric-icon">üß≠</span>
                        <span class="metric-name">Clock Angle</span>
                      </div>
                      <div class="metric-clock">
                        <div class="clock-face">
                          <div class="clock-marker north">N</div>
                          <div class="clock-marker south">S</div>
                          <div class="clock-arrow" id="clock-arrow"></div>
                        </div>
                        <div class="clock-value">
                          <span class="val" id="clock-current">--</span>
                          <span class="unit">¬∞</span>
                        </div>
                      </div>
                      <div class="metric-status" id="clock-status">--</div>
                    </div>

                    <!-- Bz Duration -->
                    <div class="metric-card" data-tooltip="How long Bz has been southward in the last 30 minutes.">
                      <div class="metric-header">
                        <span class="metric-icon">‚è±Ô∏è</span>
                        <span class="metric-name">Bz Duration</span>
                      </div>
                      <div class="metric-values">
                        <div class="metric-current">
                          <span class="val" id="duration-current">--</span>
                          <span class="unit">min</span>
                        </div>
                        <div class="metric-vs">of 30</div>
                        <div class="metric-baseline">
                          <span class="val">min</span>
                          <span class="unit">south</span>
                        </div>
                      </div>
                      <div class="metric-bar"><div class="metric-fill" id="duration-bar"></div></div>
                      <div class="metric-status" id="duration-status">--</div>
                    </div>

                  </div>
                </section>

                <!-- Viewing Info -->
                <section class="info-section">
                  <div class="info-grid">
                    <div class="info-item">
                      <span class="info-label">Your Location</span>
                      <span class="info-value" id="user-latitude">--¬∞</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Visible At</span>
                      <span class="info-value" id="visible-latitude">--¬∞N+</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Sky Status</span>
                      <span class="info-value" id="darkness-status">--</span>
                    </div>
                    <div class="info-item">
                      <span class="info-label">Data Age</span>
                      <span class="info-value" id="data-time">--</span>
                    </div>
                  </div>
                </section>

                <!-- NOAA OVATION Aurora Forecast -->
                <section class="ovation-section">
                  <div class="ovation-header">
                    <span class="ovation-icon">üõ∞Ô∏è</span>
                    <span class="ovation-title">NOAA Aurora Forecast</span>
                  </div>
                  <div class="ovation-content">
                    <div class="ovation-prob">
                      <span class="ovation-label">At Your Location</span>
                      <span class="ovation-value" id="ovation-local">--%</span>
                    </div>
                    <div class="ovation-prob">
                      <span class="ovation-label">Visible North ‚ÑπÔ∏è</span>
                      <span class="ovation-value" id="ovation-north">--%</span>
                    </div>
                  </div>
                  <p class="ovation-note" id="ovation-time">30-90 min forecast</p>
                </section>

              </div>

            </div>

          </main>
        </div>
      </div>

      <!-- Crypto Module -->
      <div class="module-panel" id="panel-crypto">
        <!-- Loaded dynamically -->
      </div>

      <!-- Stocks Module -->
      <div class="module-panel" id="panel-stocks">
        <!-- Loaded dynamically -->
      </div>

      <!-- News Module -->
      <div class="module-panel" id="panel-news">
        <!-- Loaded dynamically -->
      </div>

      <!-- Settings Module -->
      <div class="module-panel" id="panel-settings">
        <!-- Loaded dynamically -->
      </div>

    </main>

    <!-- Global Footer -->
    <footer class="nocturne-footer">
      <p>Data: <a href="https://www.swpc.noaa.gov/" target="_blank">NOAA SWPC</a> ‚Ä¢ Various APIs</p>
      <p>Nocturne v3.1.0 - Your 24x7 Personal Assistant</p>
    </footer>

  </div>

  <!-- Charts Library -->
  <script src="/src/js/charts.js"></script>
  <script src="/src/js/nocturne.js" type="module"></script>
  
  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/public/sw.js')
          .then(reg => console.log('[PWA] Service Worker registered'))
          .catch(err => console.log('[PWA] SW registration failed:', err));
      });
    }
  </script>
</body>
</html>
